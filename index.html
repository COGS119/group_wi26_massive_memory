<!DOCTYPE html>
<html>

<head>
  <title>Massive Memory</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>

<body></body>
<script>

  /* initialize jsPsych */
  var jsPsych = initJsPsych({
    on_finish: function () {
      jsPsych.data.displayData();
    }
  });

  /* create timeline */
  var timeline = [];

  /* item name arrays */

  // Exemplar item names â€” all use .jpg except "teapot" which uses .JPG
  var exemplar_names = [
    "basket", "bell", "bicycle", "bracelet", "bread", "cabinet", "calculator",
    "camera", "car", "chisel", "chocolatebar", "cone", "dispenser", "fan",
    "feather", "frame", "game", "globe", "goggles", "grapes", "hanger",
    "headphones", "helmet", "holepunch", "horn", "icecream", "key", "ladder",
    "meter", "microscope", "mitt", "money", "muffin", "muffler", "nozzle",
    "pacifier", "peppers", "piano", "pizza", "pliers", "potatochips", "razor",
    "remote", "sharpener", "soapdish", "soccerball", "spraybottle", "stapler",
    "starfish", "string", "suitcase", "sunglasses", "teapot", "tongs", "toyplane",
    "tractor", "train", "trophy", "turtle", "wheelchair"
  ];

  // State items where BOTH files use .jpg
  var state_jpg = [
    "abacus", "applesgreenbasket", "belt", "box", "briefcase", "brushes",
    "chinesefoodbox", "crayons", "die", "donut", "dresser", "drum", "dryer",
    "eggs", "firetrucktoy", "flask", "giftbag", "giftbox", "grinder",
    "hairbrush", "iron", "medicaltape", "mug", "napkins", "patiotable",
    "peppers", "pestle", "picnicbasket", "polarbear", "pumpkinpie",
    "racquet", "rhino", "scales", "seatbelt", "seats", "sweater",
    "teacup", "tent", "tiger", "typewriter", "waffleiron", "yarn"
  ];

  // State items where BOTH files use .JPG
  var state_JPG = [
    "babytoy", "books", "bottles", "breadbox", "bureau", "coffeemaker",
    "container", "cookies", "dishes", "juiceglass", "laptop", "phone",
    "pie", "potpan", "scanner", "scissors"
  ];

  // 10 novel pairs for attention checks (n01-n10)
  var novel_pairs = [
    {num: "01", a: "ladybug", b: "coin"},
    {num: "02", a: "axe", b: "safetypin"},
    {num: "03", a: "camel", b: "bagel"},
    {num: "04", a: "yarn", b: "bandaid"},
    {num: "05", a: "barrel", b: "cactus"},
    {num: "06", a: "cane", b: "lipstick"},
    {num: "07", a: "potato", b: "swimmingpool"},
    {num: "08", a: "oven", b: "paperclip"},
    {num: "09", a: "penguin", b: "saddle"},
    {num: "10", a: "windmill", b: "turkey"}
  ];

  /* build test_list from name arrays */
  var test_list = [];

  // Add exemplar pairs
  exemplar_names.forEach(function(name) {
    var ext = (name === "teapot") ? ".JPG" : ".jpg";
    test_list.push({
      item_1: "E" + name + "1" + ext,
      item_2: "E" + name + "2" + ext,
      test_type: "exemplar",
      path_to_image: "stimuli/organized/EXEMPLAR/USED/"
    });
  });

  // Add state pairs (.jpg extension)
  state_jpg.forEach(function(name) {
    test_list.push({
      item_1: "S" + name + "1.jpg",
      item_2: "S" + name + "2.jpg",
      test_type: "state",
      path_to_image: "stimuli/organized/STATE/USED/"
    });
  });

  // Add state pairs (.JPG extension)
  state_JPG.forEach(function(name) {
    test_list.push({
      item_1: "S" + name + "1.JPG",
      item_2: "S" + name + "2.JPG",
      test_type: "state",
      path_to_image: "stimuli/organized/STATE/USED/"
    });
  });

  // Add the 2 state pairs with mismatched extensions
  test_list.push({
    item_1: "Sbagel1.JPG", item_2: "Sbagel2.jpg",
    test_type: "state", path_to_image: "stimuli/organized/STATE/USED/"
  });
  test_list.push({
    item_1: "Smetronome1.jpg", item_2: "Smetronome2.JPG",
    test_type: "state", path_to_image: "stimuli/organized/STATE/USED/"
  });

  // Add novel pairs
  novel_pairs.forEach(function(pair) {
    test_list.push({
      item_1: "n" + pair.num + "a" + pair.a + ".jpg",
      item_2: "n" + pair.num + "b" + pair.b + ".jpg",
      test_type: "novel",
      path_to_image: "stimuli/organized/Novel pairs (tested)/"
    });
  });

  // Counterbalance: randomly swap item_1/item_2 for exactly half of all pairs
  // repeat([true, false], N) creates N trues + N falses, shuffled
  var swap_flags = jsPsych.randomization.repeat([true, false], Math.floor(test_list.length / 2));

  test_list.forEach(function(pair, index) {
    if (swap_flags[index]) {
      var temp = pair.item_1;
      pair.item_1 = pair.item_2;
      pair.item_2 = temp;
    }
  });

  /* build memory list from test list (study the item_1 from each pair) */
  var memory_list = test_list.map(function(item) {
    return item.path_to_image + item.item_1;
  });

  // (shuffling handled by randomize_order in timeline variables below)

  //cycle through memory list using a for loop
  for (i = 0; i < memory_list_shuffled.length; i++) {

    //select the current image item
    var current_image = memory_list_shuffled[i];

    //add fixation cross
    var fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: "NO_KEYS",
      trial_duration: 1000,
    };

    timeline.push(fixation);

    // here's how we can construct a simple image trial
    // TO DO: add repeated trials
    // what else do we need to add to the trial procedure? What other information should we store? How can we turn this into a complete experiment timeline?
    var trial = {
      type: jsPsychImageKeyboardResponse,
      stimulus: current_image,
      //make the space bar a response option
      choices: [" "],
      //the stimulus is shown for 3000 ms
      trial_duration: 3000,
      //response should not end trial so that we can keep the same consistent presentation timing
      response_ends_trial: false,
      data: {
        trial_phase: "memory"
      }
    }
    //push the trial to the timeline
    timeline.push(trial);
  }

  //cycle through test list using a for loop
  for (i = 0; i < test_list_shuffled.length; i++) {
    //select the current item
    var current_item = test_list_shuffled[i];
    var image_1 = current_item["path_to_image"]+current_item["item_1"];
    var image_2 = current_item["path_to_image"]+current_item["item_2"];

    //TO DO: how can we randomize image positions? How can we ensure that the old/new items are correctly marked?
    var test_trial = {
      type: jsPsychHtmlButtonResponse,
      stimulus: "Which of these items did you see before?",
      choices: ['<img src="'+image_1+'">', '<img src="'+image_2+'">'],
      data: {
        trial_phase: "test"
      }
    };
    timeline.push(test_trial);

  }

  /* start the experiment */
  jsPsych.run(timeline);

</script>

</html>